<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZChords | Live Repertoire</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, onSnapshot, query, where, updateDoc, doc, deleteDoc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // !!! BU HİSSƏNİ FİREBASE-DƏN ALDIĞIN KODLA ƏVƏZ ET !!!
        const firebaseConfig = {
            apiKey: "SƏNİN_API_KEY",
            authDomain: "azchords-xxxxx.firebaseapp.com",
            projectId: "azchords-xxxxx",
            storageBucket: "azchords-xxxxx.appspot.com",
            messagingSenderId: "xxxxxx",
            appId: "xxxxx"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- GLOBAL DEĞİŞKENLER ---
        window.db = db;
        window.currentView = 'home-view';
        window.currentUser = JSON.parse(localStorage.getItem('azUser')) || null;

        // --- MAHNILARI CANLI GƏTİR (Firebase onSnapshot) ---
        const songsCol = collection(db, "songs");
        onSnapshot(query(songsCol, orderBy("timestamp", "desc")), (snapshot) => {
            const songsList = [];
            snapshot.forEach(doc => songsList.push({ id: doc.id, ...doc.data() }));
            window.allSongs = songsList;
            renderSongs();
            if(window.currentUser?.role === 'admin') renderAdminPanel();
        });

        // --- MAHNİ ƏLAVƏ ET ---
        window.submitSong = async () => {
            const title = document.getElementById('songTitle').value;
            const artist = document.getElementById('songArtist').value;
            const content = document.getElementById('songChords').value;
            
            if(!title || !content) return alert("Məlumatları doldurun!");

            try {
                await addDoc(songsCol, {
                    title, artist,
                    capo: document.getElementById('songCapo').value || 0,
                    ton: document.getElementById('songTon').value || 'Am',
                    content,
                    status: (window.currentUser?.role === 'admin') ? 'approved' : 'pending',
                    author: window.currentUser.email,
                    timestamp: Date.now()
                });
                alert("Mahnı göndərildi!");
                closeModal('addModal');
            } catch (e) { alert("Xəta baş verdi: " + e.message); }
        };

        // --- TƏSDİQLƏMƏ (Admin üçün) ---
        window.approveSong = async (id) => {
            const songRef = doc(db, "songs", id);
            await updateDoc(songRef, { status: 'approved' });
        };

        window.deleteSong = async (id) => {
            if(confirm("Silmək istədiyinizə əminsiniz?")) {
                await deleteDoc(doc(db, "songs", id));
            }
        };
    </script>

    <style>
        /* Sənin köhnə dizayn kodların bura gələcək (Eynisini saxla) */
        :root { --bg: #f8fafc; --surface: #ffffff; --primary: #0f172a; --accent: #2563eb; --text: #1e293b; --sub: #64748b; --border: #e2e8f0; --radius: 16px; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; }
        nav { background: var(--surface); border-bottom: 1px solid var(--border); padding: 18px 0; position: sticky; top: 0; z-index: 1000; }
        .nav-content { max-width: 1100px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--primary); text-decoration: none; letter-spacing: -1.5px; cursor: pointer; }
        .logo span { color: var(--accent); }
        .container { max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        .view { display: none; opacity: 0; transition: 0.3s; }
        .view.active { display: block; opacity: 1; }
        .song-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .song-card { background: var(--surface); padding: 25px; border-radius: var(--radius); border: 1px solid var(--border); cursor: pointer; transition: 0.3s; position: relative; }
        .song-card:hover { transform: translateY(-5px); border-color: var(--accent); }
        .btn { padding: 10px 20px; border-radius: 10px; border: none; font-weight: 600; cursor: pointer; font-family: inherit; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 450px; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid var(--border); border-radius: 10px; box-sizing: border-box; }
        pre { font-family: 'JetBrains Mono', monospace; line-height: 2.2; white-space: pre-wrap; padding: 20px; background: #f1f5f9; border-radius: 12px; }
        .chord { color: #e11d48; font-weight: 800; }
        #admin-panel { background: #eff6ff; padding: 20px; border-radius: 16px; margin-bottom: 30px; display: none; border: 1px solid #bfdbfe; }
    </style>
</head>
<body>

<nav>
    <div class="nav-content">
        <div class="logo" onclick="showView('home-view')">AZ<span>Chords</span></div>
        <div id="nav-auth">
            <button class="btn btn-outline" onclick="openModal('loginModal')">Giriş</button>
        </div>
    </div>
</nav>

<div class="container">
    <div id="admin-panel">
        <h3 style="margin-top:0">Moderasiya Paneli</h3>
        <div id="admin-list"></div>
    </div>

    <div id="home-view" class="view active">
        <div style="display:flex; justify-content:space-between; margin-bottom:30px; align-items:center;">
            <h1>Bütün Mahnılar</h1>
            <button class="btn btn-primary" onclick="checkAuth()">+ Mahnı Əlavə Et</button>
        </div>
        <div id="song-grid" class="song-grid"></div>
    </div>

    <div id="detail-view" class="view">
        <button class="btn btn-outline" onclick="showView('home-view')" style="margin-bottom:20px;">← Geri</button>
        <div id="song-content"></div>
    </div>
</div>

<!-- LOGIN MODAL -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <h2>Daxil Ol</h2>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPass" placeholder="Şifrə">
        <button class="btn btn-primary" style="width:100%" onclick="login()">Giriş</button>
        <p style="text-align:center; font-size:0.8rem; margin-top:15px; color:var(--sub)">
            Siz hələ də qeydiyyatdan keçməmisiniz? <br>
            <a href="#" style="color:var(--accent)" onclick="alert('Qeydiyyat funksiyasını da Firebase Auth ilə edə bilərsən. Hələlik admin girişi: admin@azchords.com / 123456')">Qeydiyyat</a>
        </p>
        <button class="btn" style="width:100%; margin-top:10px;" onclick="closeModal('loginModal')">Bağla</button>
    </div>
</div>

<!-- ADD MODAL -->
<div id="addModal" class="modal">
    <div class="modal-content">
        <h2>Yeni Mahnı Göndər</h2>
        <input type="text" id="songTitle" placeholder="Mahnı adı">
        <input type="text" id="songArtist" placeholder="Sənətçi">
        <input type="number" id="songCapo" placeholder="Kapo">
        <input type="text" id="songTon" placeholder="Ton">
        <textarea id="songChords" placeholder="Akorları mötərizədə [Am] yazın..."></textarea>
        <button class="btn btn-primary" style="width:100%" onclick="submitSong()">Göndər</button>
        <button class="btn" style="width:100%; margin-top:10px;" onclick="closeModal('addModal')">Ləğv et</button>
    </div>
</div>

<script>
    // --- LOGIN MƏNTİQİ (Sadeləşdirilmiş) ---
    function login() {
        const email = document.getElementById('loginEmail').value;
        const pass = document.getElementById('loginPass').value;
        
        if(email === "admin@azchords.com" && pass === "123456") {
            window.currentUser = { email, role: 'admin', name: 'Admin' };
        } else {
            window.currentUser = { email, role: 'user', name: email.split('@')[0] };
        }
        
        localStorage.setItem('azUser', JSON.stringify(window.currentUser));
        location.reload();
    }

    function checkAuth() {
        if(!window.currentUser) {
            alert("Öncə giriş etməlisiniz!");
            openModal('loginModal');
        } else openModal('addModal');
    }

    function renderSongs() {
        const grid = document.getElementById('song-grid');
        grid.innerHTML = '';
        
        const visible = window.allSongs.filter(s => s.status === 'approved' || (window.currentUser && s.author === window.currentUser.email));
        
        visible.forEach(song => {
            const card = document.createElement('div');
            card.className = 'song-card';
            card.onclick = () => viewSong(song.id);
            card.innerHTML = `
                ${song.status === 'pending' ? '<span style="color:orange; font-size:0.7rem">Yoxlanışda</span>' : ''}
                <h3 style="margin:0">${song.title}</h3>
                <p style="margin:5px 0 0 0; color:var(--sub)">${song.artist}</p>
            `;
            grid.appendChild(card);
        });
    }

    function renderAdminPanel() {
        const panel = document.getElementById('admin-panel');
        const list = document.getElementById('admin-list');
        const pending = window.allSongs.filter(s => s.status === 'pending');
        
        if(pending.length > 0) {
            panel.style.display = 'block';
            list.innerHTML = '';
            pending.forEach(s => {
                const item = document.createElement('div');
                item.style = "display:flex; justify-content:space-between; background:white; padding:10px; border-radius:8px; margin-top:10px;";
                item.innerHTML = `
                    <span>${s.title} (${s.artist})</span>
                    <div>
                        <button class="btn btn-primary" onclick="approveSong('${s.id}')">Təsdiqlə</button>
                        <button class="btn" style="color:red" onclick="deleteSong('${s.id}')">Sil</button>
                    </div>
                `;
                list.appendChild(item);
            });
        } else {
            panel.style.display = 'none';
        }
    }

    function viewSong(id) {
        const song = window.allSongs.find(s => s.id === id);
        const content = document.getElementById('song-content');
        const formatted = song.content.replace(/\[(.*?)\]/g, '<span class="chord">$1</span>');
        
        content.innerHTML = `
            <h1>${song.title}</h1>
            <p>${song.artist} | Kapo: ${song.capo} | Ton: ${song.ton}</p>
            <pre>${formatted}</pre>
        `;
        showView('detail-view');
    }

    function showView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
</script>

</body>
</html>