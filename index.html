<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AZChords Pro | Cloud Powered</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #0a0a0b; --surface: #161618; --border: #262629;
            --accent: #3b82f6; --text-main: #f4f4f5; --text-dim: #a1a1aa;
            --danger: #ef4444; --gold: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text-main); }
        .container { max-width: 900px; margin: 0 auto; padding: 0 20px; }
        .hidden { display: none !important; }

        /* Auth Screen */
        .auth-page { height: 100vh; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle, #111 0%, #000 100%); }
        .auth-box { background: var(--surface); border: 1px solid var(--border); padding: 40px; border-radius: 20px; width: 100%; max-width: 380px; }
        .error-msg { color: var(--danger); font-size: 0.8rem; margin-bottom: 10px; display: none; text-align: center; }

        input, textarea, select {
            width: 100%; padding: 12px; margin-bottom: 15px; background: #000; border: 1px solid var(--border); border-radius: 10px; color: white; outline: none;
        }
        .btn { cursor: pointer; padding: 12px; border-radius: 10px; border: none; font-weight: 600; width: 100%; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-google { background: white; color: black; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* UI */
        header { padding: 20px 0; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: rgba(10,10,11,0.9); backdrop-filter: blur(10px); z-index: 100; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--accent); cursor: pointer; }
        .nav-icons { display: flex; gap: 15px; align-items: center; }
        .nav-icons i { cursor: pointer; color: var(--text-dim); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: var(--surface); border: 1px solid var(--border); padding: 20px; border-radius: 15px; cursor: pointer; position: relative; }
        .chord-display { background: #000; padding: 25px; border-radius: 15px; border: 1px solid var(--border); font-family: 'Fira Code', monospace; line-height: 2; overflow-x: auto; color: #7dd3fc; white-space: pre-wrap; }
        
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 999; }
    </style>
</head>
<body>

<!-- Loader -->
<div id="loader" class="loading-overlay hidden">
    <i class="fa fa-spinner fa-spin fa-2x"></i>
</div>

<div id="app">
    <!-- Login/Register Page -->
    <div id="auth-screen" class="auth-page">
        <div class="auth-box">
            <h2 id="auth-title" style="text-align: center; margin-bottom: 20px;">AZChords</h2>
            <div id="error-box" class="error-msg"></div>
            
            <div id="reg-fields" class="hidden">
                <input type="text" id="user-name" placeholder="Adınız">
            </div>
            
            <input type="email" id="user-email" placeholder="E-mail">
            <input type="password" id="user-pass" placeholder="Şifrə">
            
            <button class="btn btn-primary" id="main-auth-btn" onclick="processAuth()">Daxil ol</button>
            <button class="btn btn-google" onclick="googleLogin()">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="16"> Google ilə giriş
            </button>
            
            <p style="text-align: center; margin-top: 20px; font-size: 0.8rem; color: var(--text-dim);">
                <span id="auth-switch-text">Hesabınız yoxdur?</span> 
                <span style="color: var(--accent); cursor: pointer;" onclick="toggleAuthMode()" id="auth-switch-link">Qeydiyyat</span>
            </p>
        </div>
    </div>

    <!-- Main Platform -->
    <div id="main-platform" class="hidden">
        <header class="container">
            <div class="logo" onclick="showPage('home')">AZChords</div>
            <div class="nav-icons">
                <i class="fa fa-plus-circle" onclick="showPage('add')"></i>
                <i class="fa fa-heart" onclick="showPage('favs')"></i>
                <i id="admin-icon" class="fa fa-user-shield hidden" onclick="showPage('admin')"></i>
                <i class="fa fa-sign-out-alt" onclick="signOutUser()" style="color: var(--danger);"></i>
            </div>
        </header>

        <main class="container" style="padding: 20px 0;">
            <!-- Home -->
            <section id="page-home" class="page">
                <input type="text" placeholder="Axtarış..." oninput="filterSongs(this.value)">
                <h3>Repertuarlar</h3>
                <div id="artist-list" class="grid"></div>
                <h3 style="margin-top: 30px;">Son Əlavələr</h3>
                <div id="song-list" class="grid"></div>
            </section>

            <!-- Song Detail -->
            <section id="page-view" class="page hidden">
                <button onclick="showPage('home')" style="background: none; border: none; color: white; cursor: pointer; margin-bottom: 15px;">← Geri</button>
                <div style="display: flex; justify-content: space-between;">
                    <h1 id="v-title"></h1>
                    <i id="v-fav" class="fa fa-heart" style="font-size: 1.5rem; cursor: pointer;"></i>
                </div>
                <p id="v-artist" style="color: var(--accent); margin-bottom: 20px;"></p>
                <select id="capo-select" onchange="transpose()" style="width: auto;">
                    <option value="0">Capo: 0</option>
                    <option value="1">Capo: 1</option>
                    <option value="2">Capo: 2</option>
                    <option value="-1">Capo: -1</option>
                </select>
                <pre id="v-chords" class="chord-display"></pre>
            </section>

            <!-- Add Song -->
            <section id="page-add" class="page hidden">
                <h2>Yeni Akord Göndər</h2>
                <input type="text" id="new-title" placeholder="Mahnı adı">
                <input type="text" id="new-artist" placeholder="Musiqiçi">
                <textarea id="new-chords" rows="10" placeholder="Akordlar və sözlər..."></textarea>
                <button class="btn btn-primary" onclick="uploadSong()">Təsdiqə göndər</button>
            </section>

            <!-- Admin -->
            <section id="page-admin" class="page hidden">
                <h2>Təsdiq Gözləyənlər</h2>
                <div id="admin-list" class="grid"></div>
            </section>
        </main>
    </div>
</div>

<!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, query, where, updateDoc, doc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // MÜTLƏQ: Öz Firebase məlumatlarını bura yapışdır!
const firebaseConfig = {
  apiKey: "AIzaSyBbdvOjI-7PfeEXANaEbOVcZUhG9aM-bbc",
  authDomain: "azchords-1d562.firebaseapp.com",
  projectId: "azchords-1d562",
  storageBucket: "azchords-1d562.firebasestorage.app",
  messagingSenderId: "490539531496",
  appId: "1:490539531496:web:1666193bb0f108807a1d5d",
  measurementId: "G-RJB4GZ88XB"
};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    let isLoginMode = true;
    let allSongs = [];
    let currentChords = "";

    // Auth Logic
    window.processAuth = async () => {
        const email = document.getElementById('user-email').value;
        const pass = document.getElementById('user-pass').value;
        const errBox = document.getElementById('error-box');
        
        errBox.style.display = 'none';
        if(!email || !pass) return showError("Xanaları doldurun!");

        try {
            if(isLoginMode) {
                await signInWithEmailAndPassword(auth, email, pass);
            } else {
                await createUserWithEmailAndPassword(auth, email, pass);
            }
        } catch (error) {
            showError("Məlumatlar yanlışdır və ya xəta baş verdi!");
        }
    };

    window.googleLogin = async () => {
        try { await signInWithPopup(auth, provider); } 
        catch (e) { showError("Google girişi uğursuz oldu."); }
    };

    window.signOutUser = () => signOut(auth);

    onAuthStateChanged(auth, (user) => {
        if (user) {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-platform').classList.remove('hidden');
            if(user.email === "admin@azchords.com") document.getElementById('admin-icon').classList.remove('hidden');
            loadData();
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('main-platform').classList.add('hidden');
        }
    });

    // Database Logic
    async function loadData() {
        onSnapshot(collection(db, "songs"), (snapshot) => {
            allSongs = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
            renderSongs();
        });
    }

    window.uploadSong = async () => {
        const title = document.getElementById('new-title').value;
        const artist = document.getElementById('new-artist').value;
        const chords = document.getElementById('new-chords').value;

        if(!title || !artist || !chords) return alert("Boş qoymayın!");

        await addDoc(collection(db, "songs"), {
            title, artist, chords, status: "pending", createdAt: new Date()
        });
        alert("Göndərildi!");
        showPage('home');
    };

    function renderSongs() {
        const list = document.getElementById('song-list');
        const adminList = document.getElementById('admin-list');
        list.innerHTML = ""; adminList.innerHTML = "";

        allSongs.forEach(s => {
            const card = document.createElement('div');
            card.className = "card";
            card.innerHTML = `<h3>${s.title}</h3><p>${s.artist}</p>`;
            
            if(s.status === "approved") {
                card.onclick = () => openSong(s);
                list.appendChild(card);
            } else if(auth.currentUser.email === "admin@azchords.com") {
                card.innerHTML += `<button onclick="approveSong('${s.id}')" style="background:green; color:white; border:none; padding:5px; margin-top:5px; border-radius:5px;">Təsdiqlə</button>`;
                adminList.appendChild(card);
            }
        });
    }

    window.approveSong = async (id) => {
        await updateDoc(doc(db, "songs", id), { status: "approved" });
    };

    function openSong(song) {
        currentChords = song.chords;
        document.getElementById('v-title').innerText = song.title;
        document.getElementById('v-artist').innerText = song.artist;
        document.getElementById('v-chords').innerText = song.chords;
        showPage('view');
    }

    // Helpers
    window.toggleAuthMode = () => {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-title').innerText = isLoginMode ? "Giriş" : "Qeydiyyat";
        document.getElementById('main-auth-btn').innerText = isLoginMode ? "Daxil ol" : "Qeydiyyatı tamamla";
        document.getElementById('reg-fields').classList.toggle('hidden', isLoginMode);
        document.getElementById('auth-switch-text').innerText = isLoginMode ? "Hesabınız yoxdur?" : "Artıq üzvsən?";
        document.getElementById('auth-switch-link').innerText = isLoginMode ? "Qeydiyyat" : "Giriş";
    };

    function showError(msg) {
        const box = document.getElementById('error-box');
        box.innerText = msg;
        box.style.display = 'block';
    }

    window.showPage = (pageId) => {
        document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
        document.getElementById('page-' + pageId).classList.remove('hidden');
    };

    const notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
    window.transpose = () => {
        const step = parseInt(document.getElementById('capo-select').value);
        document.getElementById('v-chords').innerText = currentChords.replace(/[CDEFGAB]#?/g, m => {
            let i = (notes.indexOf(m) + step) % 12;
            return notes[i < 0 ? i + 12 : i];
        });
    };
</script>
</body>
</html>